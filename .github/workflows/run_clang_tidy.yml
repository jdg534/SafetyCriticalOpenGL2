name: Clang-Tidy Analysis

on:
    push:
        paths:
            - 'source/**'
            - '.clang-tidy'
            - '.github/workflows/run_clang_tidy.yml'
    pull_request:
        paths:
            - 'source/**'
            - '.clang-tidy'

jobs:
    clang-tidy:
        runs-on: ubuntu-latest
        defaults:
            run:
                shell: bash
                working-directory: ./
        steps:
            - run: sudo apt update
            - run: sudo apt install -y clang-tidy cmake g++ ninja-build
            - run: pwd
            - run: git submodule update --init
            - run: cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -S . -B build
            - run: |
                find source \( -name "*.cpp" -o -name "*.h" -o \) \
                | xargs -I{} clang-tidy {} -p build
